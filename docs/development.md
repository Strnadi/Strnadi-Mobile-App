# Development Setup

This guide explains how to prepare a workstation for hacking on Návrat krále, run the mobile clients, and keep quality checks green.

## Prerequisites
- Flutter SDK **3.3 or newer** (stable channel recommended).【F:pubspec.yaml†L16-L23】
- Dart SDK installed alongside Flutter (handled automatically when you install Flutter).【F:pubspec.yaml†L16-L23】
- Android Studio or Xcode for device emulators and platform tooling.
- Firebase project credentials with iOS/Android apps registered, along with the generated `google-services.json` and `GoogleService-Info.plist` files.
- Sentry DSN and PostHog API keys when working with production builds.【F:lib/main.dart†L29-L112】【F:pubspec.yaml†L75-L108】

## Repository bootstrap
1. Clone the repository and fetch dependencies:
   ```bash
   git clone https://github.com/Strnadi/Strnadi-Mobile-App.git
   cd Strnadi-Mobile-App
   flutter pub get
   ```
2. Copy runtime configuration templates and secrets:
   - Create `assets/secrets.json` (not tracked in Git) that contains `host`, `devhost`, and Mapy.cz API keys. Use `assets/config.json` as a starting template for local development.【F:assets/config.json†L1-L3】【F:lib/config/config.dart†L1-L160】
   - Provide `assets/firebase-secrets.json` with your Firebase service account details if you use admin features that rely on them.【F:lib/config/config.dart†L33-L77】
   - `lib/firebase_options.dart` is generated by the FlutterFire CLI. Re-run `flutterfire configure` when Firebase projects change.【F:lib/firebase/firebase.dart†L1-L160】
   - Add platform-specific Firebase files:
     - `android/app/google-services.json`
     - `ios/Runner/GoogleService-Info.plist`

3. Configure background services (Android): ensure the app has the `RECEIVE_BOOT_COMPLETED`, microphone, and location permissions declared in the platform manifests. Runtime prompts are shown by `PermissionGate` on first launch.【F:lib/main.dart†L112-L158】

## Running the app
- **Android**: `flutter run -d <device_id>` launches the debug build on an emulator or connected device. Google Play Services must be installed for map overlays and FCM tokens.【F:lib/main.dart†L52-L119】
- **iOS**: open `ios/Runner.xcworkspace` in Xcode, configure your development team, and run on a simulator or device.
- **Web/Desktop**: the project targets mobile; web/desktop shells are not maintained.

## Quality checks
Run these checks locally before opening a pull request:

```bash
flutter analyze    # Static analysis using rules from analysis_options.yaml
flutter test       # Widget and unit test suite in the /test directory
```

`flutter analyze` uses the official lint set defined in `analysis_options.yaml`. The default widget test exercises the counter app template; add focused tests alongside new features under `test/`.【F:analysis_options.yaml†L1-L80】【F:test/widget_test.dart†L1-L80】

## Useful debugging hooks
- **Logging**: Use the global `Logger` instances (e.g., in `main.dart` and `databaseNew.dart`) for structured logs. They automatically integrate with Sentry breadcrumbs in release builds.【F:lib/main.dart†L29-L112】【F:lib/database/databaseNew.dart†L18-L120】
- **Workmanager**: Background jobs are registered in `callback_dispatcher.dart`. Use `workmanager cancelAll` during development to reset state.【F:lib/callback_dispatcher.dart†L1-L120】
- **Localization**: Strings are flattened from `assets/lang/*.json` by `Localization.load()`. Update JSON files and hot-restart to see changes.【F:lib/localization/localization.dart†L1-L28】

## Release builds
1. Bump the version in `pubspec.yaml` (both `version` and build metadata).【F:pubspec.yaml†L11-L33】
2. Run `flutter pub run flutter_launcher_icons` if the icon set changed.【F:pubspec.yaml†L34-L48】
3. Build platform artefacts:
   ```bash
   flutter build apk --release
   flutter build ios --release
   ```
4. Upload native symbols and source maps to Sentry if enabled (configured under the `sentry:` section of `pubspec.yaml`).【F:pubspec.yaml†L119-L124】

## Test data & fixtures
- The repository ships with an empty SQLite schema (`assets/databaseScheme.sql`) and placeholder config to simplify local testing.【F:assets/databaseScheme.sql†L1-L22】【F:assets/config.json†L1-L3】
- Use the `soundNew.db` sample database to inspect schema changes without connecting to production services.

